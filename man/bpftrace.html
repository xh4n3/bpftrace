<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="generator" content="Asciidoctor 2.0.16"/>
<title>bpftrace(8)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"/>
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="manpage">
<div id="header">
<h1>bpftrace(8) Manual Page</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_synopsis">Synopsis</a></li>
<li><a href="#_description">Description</a></li>
<li><a href="#_examples">Examples</a></li>
<li><a href="#_supported_architectures">Supported architectures</a></li>
<li><a href="#_options">Options</a>
<ul class="sectlevel2">
<li><a href="#flags_output_format">Output format</a></li>
<li><a href="#flags_tracing">Tracing</a></li>
<li><a href="#flags_process_management">Process management</a></li>
<li><a href="#flags_miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li><a href="#flags_environment_variables">Environment Variables</a>
<ul class="sectlevel2">
<li><a href="#envvar_bpftrace_strlen">BPFTRACE_STRLEN</a></li>
<li><a href="#envvar_bpftrace_no_cpp_demangle">BPFTRACE_NO_CPP_DEMANGLE</a></li>
<li><a href="#envvar_bpftrace_map_keys_max">BPFTRACE_MAP_KEYS_MAX</a></li>
<li><a href="#envvar_bpftrace_max_probes">BPFTRACE_MAX_PROBES</a></li>
<li><a href="#envvar_bpftrace_cache_user_symbols">BPFTRACE_CACHE_USER_SYMBOLS</a></li>
<li><a href="#envvar_bpftrace_vmlinux">BPFTRACE_VMLINUX</a></li>
<li><a href="#envvar_bpftrace_btf">BPFTRACE_BTF</a></li>
<li><a href="#envvar_bpftrace_perf_rb_pages">BPFTRACE_PERF_RB_PAGES</a></li>
<li><a href="#envvar_bpftrace_max_bpf_progs">BPFTRACE_MAX_BPF_PROGS</a></li>
<li><a href="#envvar_bpftrace_str_trunc_trailer">BPFTRACE_STR_TRUNC_TRAILER</a></li>
<li><a href="#envvar_bpftrace_stack_mode">BPFTRACE_STACK_MODE</a></li>
</ul>
</li>
<li><a href="#language_bpftrace_language">bpftrace Language</a>
<ul class="sectlevel2">
<li><a href="#language_overview">Overview</a></li>
<li><a href="#language_identifiers">Identifiers</a></li>
<li><a href="#language_comments">Comments</a></li>
<li><a href="#language_data_types">Data Types</a></li>
<li><a href="#language_constants">Constants</a></li>
<li><a href="#language_type_conversion">Type conversion</a></li>
<li><a href="#language_operators_and_expressions">Operators and Expressions</a></li>
<li><a href="#language_variables_and_maps">Variables and Maps</a></li>
<li><a href="#language_variable_scoping">Variable scoping</a></li>
<li><a href="#language_pointers">Pointers</a></li>
<li><a href="#language_tuples">Tuples</a></li>
<li><a href="#language_structs">Structs</a></li>
<li><a href="#language_conditionals">Conditionals</a></li>
<li><a href="#language_loops">Loops</a></li>
</ul>
</li>
<li><a href="#_invocation_mode">Invocation Mode</a></li>
<li><a href="#_address_spaces">Address-spaces</a></li>
<li><a href="#_builtins">Builtins</a></li>
<li><a href="#functions_map_functions">Map Functions</a>
<ul class="sectlevel2">
<li><a href="#functions_avg">avg</a></li>
<li><a href="#functions_clear">clear</a></li>
<li><a href="#functions_count">count</a></li>
<li><a href="#functions_delete">delete</a></li>
<li><a href="#functions_hist">hist</a></li>
<li><a href="#functions_lhist">lhist</a></li>
<li><a href="#functions_max">max</a></li>
<li><a href="#functions_min">min</a></li>
<li><a href="#functions_stats">stats</a></li>
<li><a href="#functions_sum">sum</a></li>
<li><a href="#functions_zero">zero</a></li>
</ul>
</li>
<li><a href="#functions_functions">Functions</a>
<ul class="sectlevel2">
<li><a href="#functions_bswap">bswap</a></li>
<li><a href="#functions_buf">buf</a></li>
<li><a href="#functions_cat">cat</a></li>
<li><a href="#functions_cgroup_path">cgroup_path</a></li>
<li><a href="#functions_cgroupid">cgroupid</a></li>
<li><a href="#functions_exit">exit</a></li>
<li><a href="#functions_join">join</a></li>
<li><a href="#functions_kaddr">kaddr</a></li>
<li><a href="#functions_kptr">kptr</a></li>
<li><a href="#functions_ksym">ksym</a></li>
<li><a href="#functions_macaddr">macaddr</a></li>
<li><a href="#functions_ntop">ntop</a></li>
<li><a href="#functions_pton">pton</a></li>
<li><a href="#functions_override">override</a></li>
<li><a href="#functions_reg">reg</a></li>
<li><a href="#functions_signal">signal</a></li>
<li><a href="#functions_sizeof">sizeof</a></li>
<li><a href="#functions_offsetof">offsetof</a></li>
<li><a href="#functions_str">str</a></li>
<li><a href="#functions_strerror">strerror</a></li>
<li><a href="#functions_strftime">strftime</a></li>
<li><a href="#functions_strncmp">strncmp</a></li>
<li><a href="#functions_strcontains">strcontains</a></li>
<li><a href="#functions_system">system</a></li>
<li><a href="#functions_time">time</a></li>
<li><a href="#functions_uaddr">uaddr</a></li>
<li><a href="#functions_uptr">uptr</a></li>
<li><a href="#functions_usym">usym</a></li>
<li><a href="#functions_path">path</a></li>
<li><a href="#functions_unwatch">unwatch</a></li>
<li><a href="#functions_skboutput">skboutput</a></li>
</ul>
</li>
<li><a href="#functions_output_formatting">Output formatting</a>
<ul class="sectlevel2">
<li><a href="#functions_print">print</a></li>
<li><a href="#functions_printf">printf</a></li>
</ul>
</li>
<li><a href="#_probes">Probes</a>
<ul class="sectlevel2">
<li><a href="#probes-begin-end">BEGIN and END</a></li>
<li><a href="#probes-hardware">hardware</a></li>
<li><a href="#probes-interval">interval</a></li>
<li><a href="#probes-iterator">iterator</a></li>
<li><a href="#probes-kfunc">kfunc and kretfunc</a></li>
<li><a href="#probes-kprobe">kprobe and kretprobe</a></li>
<li><a href="#probes-profile">profile</a></li>
<li><a href="#probes-software">software</a></li>
<li><a href="#probes-tracepoint">tracepoint</a></li>
<li><a href="#probes-rawtracepoint">rawtracepoint</a></li>
<li><a href="#probes-uprobe">uprobe, uretprobe</a></li>
<li><a href="#probes-usdt">usdt</a></li>
<li><a href="#probes-watchpoint">watchpoint and asyncwatchpoint</a></li>
</ul>
</li>
<li><a href="#_listing_probes">Listing Probes</a></li>
</ul>
</div>
<h2 id="_name">Name</h2>
<div class="sectionbody">
<p>bpftrace - a high-level tracing language</p>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_synopsis">Synopsis</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>bpftrace</strong> [<em>OPTIONS</em>] <em>FILENAME</em><br/>
<strong>bpftrace</strong> [<em>OPTIONS</em>] -e 'program code'</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_description">Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>bpftrace is a high-level tracing language and runtime for Linux based on BPF.
It supports static and dynamic tracing for both the kernel and user-space.</p>
</div>
<div class="paragraph">
<p>When <em>FILENAME</em> is "<em>-</em>", read from stdin.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">Examples</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">List all probes with "sleep" in their name</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>  # bpftrace -l '*sleep*'</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Trace processes calling sleep</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>  # bpftrace -e 'kprobe:do_nanosleep { printf("%d sleeping\n", pid); }'</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Trace processes calling sleep while spawning <code>sleep 5</code> as a child process</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>  # bpftrace -e 'kprobe:do_nanosleep { printf("%d sleeping\n", pid); }' -c 'sleep 5'</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_supported_architectures">Supported architectures</h2>
<div class="sectionbody">
<div class="paragraph">
<p>x86_64, arm64 and s390x</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_options">Options</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="flags_output_format">Output format</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>-B</strong> <em>MODE</em></dt>
<dt class="hdlist1">Set the buffer mode for stdout. Valid values are</dt>
<dd>
<p><strong>none</strong> No buffering. Each I/O is written as soon as possible<br/>
<strong>line</strong> Data is written on the first newline or when the buffer is full.
This is the default mode.<br/>
<strong>full</strong> Data is written once the buffer is full.</p>
</dd>
<dt class="hdlist1"><strong>-f</strong> <em>FORMAT</em></dt>
<dt class="hdlist1">Set the output format. Valid values are</dt>
<dd>
<p><strong>json</strong><br/>
<strong>text</strong></p>
</dd>
<dt class="hdlist1"><strong>-o</strong> <em>FILENAME</em></dt>
<dd>
<p>Write bpftrace tracing output to <em>FILENAME</em> instead of stdout.
This doesn&#8217;t include child process (<strong>-c</strong> option) output.
Errors are still written to stderr.</p>
</dd>
<dt class="hdlist1"><strong>--no-warnings</strong></dt>
<dd>
<p>Suppress all warning messages created by bpftrace.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="flags_tracing">Tracing</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>-e</strong> <em>PROGRAM</em></dt>
<dd>
<p>Execute <em>PROGRAM</em> instead of reading the program from a file</p>
</dd>
<dt class="hdlist1"><strong>-I</strong> <em>DIR</em></dt>
<dd>
<p>Add the directory <em>DIR</em> to the search path for C headers.
This option can be used multiple times.</p>
</dd>
<dt class="hdlist1"><strong>--include</strong> <em>FILENAME</em></dt>
<dd>
<p>Add <em>FILENAME</em> as an include for the pre-processor.
This is equal to adding '#include <em>FILENAME</em>' to the start bpftrace program.
This option can be used multiple times.</p>
</dd>
<dt class="hdlist1"><strong>-l</strong> [<em>SEARCH</em>]</dt>
<dd>
<p>List all probes that match the <em>SEARCH</em> pattern.
If the pattern is omitted all probes will be listed.
This pattern supports wildcards in the same way that probes do.
E.g. '-l kprobe:*file*' to list all 'kprobes' with 'file' in the
name. For more details see the <a href="#_listing_probes">Listing Probes</a> section.</p>
</dd>
<dt class="hdlist1"><strong>--unsafe</strong></dt>
<dd>
<p>Some calls, like 'system', are marked as unsafe as they can have dangerous side effects ('system("rm -rf")') and are disabled by default.
This flag allows their use.</p>
</dd>
<dt class="hdlist1"><strong>-k</strong></dt>
<dd>
<p>Errors from bpf-helpers(7) are silently ignored by default which can lead to strange results.
This flag enables the detection of errors (except for errors from 'probe_read_*').
When errors occurs bpftrace will log an error containing the source location and the error code:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>stdin:48-57: WARNING: Failed to probe_read_user_str: Bad address (-14)
u:lib.so:"fn(char const*)" { printf("arg0:%s\n", str(arg0));}
                                                 ~~~~~~~~~</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>-kk</strong></dt>
<dd>
<p>Same as '-k' but also includes the errors from 'probe_read_*' helpers.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="flags_process_management">Process management</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>-p</strong> <em>PID</em></dt>
<dd>
<p>Attach to the process with <em>PID</em>. If the process terminates, bpftrace will also terminate.
When using USDT probes they will be attached to only this process.</p>
</dd>
<dt class="hdlist1"><strong>-c</strong> <em>COMMAND</em></dt>
<dd>
<p>Run <em>COMMAND</em> as a child process.
When the child terminates bpftrace stops as well, as if 'exit()' has been called.
If bpftrace terminates before the child process does the child process will be terminated with a SIGTERM.
If used, 'USDT' probes these will only be attached to the child process.
To avoid a race condition when using 'USDTs' the child is stopped after 'execve' using 'ptrace(2)' and continued when all 'USDT' probes are attached.<br/>
The child PID is available to programs as the 'cpid' builtin.<br/>
The child process runs with the same privileges as bpftrace itself (usually root).</p>
</dd>
<dt class="hdlist1"><strong>--usdt-file-activation</strong></dt>
<dd>
<p>activate usdt semaphores based on file path</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="flags_miscellaneous">Miscellaneous</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>--info</strong></dt>
<dd>
<p>Print detailed information about features supported by the kernel and the bpftrace build.</p>
</dd>
<dt class="hdlist1"><strong>-h, --help</strong></dt>
<dd>
<p>Print the help summary</p>
</dd>
<dt class="hdlist1"><strong>-V, --version</strong></dt>
<dd>
<p>Print bpftrace version information</p>
</dd>
<dt class="hdlist1"><strong>-v</strong></dt>
<dd>
<p>verbose messages</p>
</dd>
<dt class="hdlist1"><strong>-d</strong></dt>
<dd>
<p>debug mode</p>
</dd>
<dt class="hdlist1"><strong>-dd</strong></dt>
<dd>
<p>verbose debug mode</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="flags_environment_variables">Environment Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some behavior can only be controlled through environment variables.
This section lists all those variables.</p>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_strlen">BPFTRACE_STRLEN</h3>
<div class="paragraph">
<p>Default: 64</p>
</div>
<div class="paragraph">
<p>Number of bytes allocated on the BPF stack for the string returned by <code>str()</code>.</p>
</div>
<div class="paragraph">
<p>Make this larger if you wish to read bigger strings with str().</p>
</div>
<div class="paragraph">
<p>Beware that the BPF stack is small (512 bytes).</p>
</div>
<div class="paragraph">
<p>Support for even larger strings is [being discussed](<a href="https://github.com/iovisor/bpftrace/issues/305" class="bare">https://github.com/iovisor/bpftrace/issues/305</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_no_cpp_demangle">BPFTRACE_NO_CPP_DEMANGLE</h3>
<div class="paragraph">
<p>Default: 0</p>
</div>
<div class="paragraph">
<p>C++ symbol demangling in user space stack traces is enabled by default.</p>
</div>
<div class="paragraph">
<p>This feature can be turned off by setting the value of this environment variable to <code>1</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_map_keys_max">BPFTRACE_MAP_KEYS_MAX</h3>
<div class="paragraph">
<p>Default: 4096</p>
</div>
<div class="paragraph">
<p>This is the maximum number of keys that can be stored in a map.
Increasing the value will consume more memory and increase startup times.
There are some cases where you will want to: for example, sampling stack traces, recording timestamps for each page, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_max_probes">BPFTRACE_MAX_PROBES</h3>
<div class="paragraph">
<p>Default: 512</p>
</div>
<div class="paragraph">
<p>This is the maximum number of probes that bpftrace can attach to.
Increasing the value will consume more memory, increase startup times and can incur high performance overhead or even freeze or crash the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_cache_user_symbols">BPFTRACE_CACHE_USER_SYMBOLS</h3>
<div class="paragraph">
<p>Default: PER_PROGRAM if ASLR disabled or <code>-c</code> option given, PER_PID otherwise.</p>
</div>
<div class="paragraph">
<p>Caching strategy for user symbols. Valid values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PER_PROGRAM - each program has its own cache. If there are more processes with enabled ASLR for a single program, this might produce incorrect results.</p>
</li>
<li>
<p>PER_PID - each process has its own cache. This is accurate for processes with ASLR enabled, and enables bpftrace to preload caches for processes running at probe attachement time. If there are many processes running, it will consume a lot of a memory.</p>
</li>
<li>
<p>NONE - caching disabled. This saves the most memory, but at the cost of speed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_vmlinux">BPFTRACE_VMLINUX</h3>
<div class="paragraph">
<p>Default: None</p>
</div>
<div class="paragraph">
<p>This specifies the vmlinux path used for kernel symbol resolution when attaching kprobe to offset.
If this value is not given, bpftrace searches vmlinux from pre defined locations.
See src/attached_probe.cpp:find_vmlinux() for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_btf">BPFTRACE_BTF</h3>
<div class="paragraph">
<p>Default: None</p>
</div>
<div class="paragraph">
<p>The path to a BTF file.
By default, bpftrace searches several locations to find a BTF file.
See src/btf.cpp for the details.</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_perf_rb_pages">BPFTRACE_PERF_RB_PAGES</h3>
<div class="paragraph">
<p>Default: 64</p>
</div>
<div class="paragraph">
<p>Number of pages to allocate per CPU for perf ring buffer.
The value must be a power of 2.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re getting a lot of dropped events bpftrace may not be processing events in the ring buffer fast enough.
It may be useful to bump the value higher so more events can be queued up.
The tradeoff is that bpftrace will use more memory.</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_max_bpf_progs">BPFTRACE_MAX_BPF_PROGS</h3>
<div class="paragraph">
<p>Default: 512</p>
</div>
<div class="paragraph">
<p>This is the maximum number of BPF programs (functions) that bpftrace can generate.
The main purpose of this limit is to prevent bpftrace from hanging since generating a lot of probes
takes a lot of resources (and it should not happen often).</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_str_trunc_trailer">BPFTRACE_STR_TRUNC_TRAILER</h3>
<div class="paragraph">
<p>Default: <code>..</code></p>
</div>
<div class="paragraph">
<p>Trailer to add to strings that were truncated. Set to empty string to disable truncation trailers.</p>
</div>
</div>
<div class="sect2">
<h3 id="envvar_bpftrace_stack_mode">BPFTRACE_STACK_MODE</h3>
<div class="paragraph">
<p>Default: bpftrace</p>
</div>
<div class="paragraph">
<p>Output format for ustack and kstack builtins. Available modes/formats: <code>bpftrace</code>, <code>perf</code>, and <code>raw</code>.
This can be overwritten at the call site.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="language_bpftrace_language">bpftrace Language</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="language_overview">Overview</h3>
<div class="paragraph">
<p>The <code>bpftrace</code> (<code>bt</code>) language is inspired by the D language used by <code>dtrace</code> and uses the same program structure.
Each script consists of an preamble and one or more action blocks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>preamble

actionblock1
actionblock2</pre>
</div>
</div>
<div class="paragraph">
<p>Preprocessor and type definitions take place in the preamble:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#include &lt;linux/socket.h&gt;
#define RED "\033[31m"

struct S {
  int x;
}</pre>
</div>
</div>
<div class="paragraph">
<p>Each action block consists of three parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>probe[,probe]
/predicate/ {
  action
}</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Probes</dt>
<dd>
<p>A probe specifies the event and event type to attach too.</p>
</dd>
<dt class="hdlist1">Predicate</dt>
<dd>
<p>The predicate is optional condition that must be met for the action to be executed.</p>
</dd>
<dt class="hdlist1">Action</dt>
<dd>
<p>  Actions are the programs that run when an event fires (and the predicate is met).
An action is a semicolon (<code>;</code>) separated list of statements and always enclosed by brackets <code>{}</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A basic script that traces the <code>open(2)</code> and <code>openat(2)</code> system calls can be written as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>BEGIN
{
	printf("Tracing open syscalls... Hit Ctrl-C to end.\n");
}

tracepoint:syscalls:sys_enter_open,
tracepoint:syscalls:sys_enter_openat
{
	printf("%-6d %-16s %s\n", pid, comm, str(args.filename));
}</pre>
</div>
</div>
<div class="paragraph">
<p>This script has two action blocks and a total of 3 probes.
The first action block uses the special <code>BEGIN</code> probe, which fires once during <code>bpftrace</code> startup.
This probe is used to print a header, indicating that the tracing has started.</p>
</div>
<div class="paragraph">
<p>The second action block uses two probes, one for <code>open</code> and one for <code>openat</code>, and defines an action that prints the file being <code>open</code> ed as well as the <code>pid</code> and <code>comm</code> of the process that execute the syscall.
See the <a href="#_probes">Probes</a> section for details on the available probe types.</p>
</div>
</div>
<div class="sect2">
<h3 id="language_identifiers">Identifiers</h3>
<div class="paragraph">
<p>Identifiers must match the following regular expression: <code>[_a-zA-Z][_a-zA-Z0-9]*</code></p>
</div>
</div>
<div class="sect2">
<h3 id="language_comments">Comments</h3>
<div class="paragraph">
<p>Both single line and multi line comments are supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// A single line comment
i:s:1 { // can also be used to comment inline
/*
 a multi line comment

*/
  print(/* inline comment block */ 1);
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="language_data_types">Data Types</h3>
<div class="paragraph">
<p>The following fundamental integer types are provided by the language.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 8 bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 8 bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 16 bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 16 bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 32 bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 32 bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsigned 64 bit integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed 64 bit integer</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="language_floating_point">Floating-point</h4>
<div class="paragraph">
<p>Floating-point numbers are not supported by BPF and therefore not by bpftrace.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="language_constants">Constants</h3>
<div class="paragraph">
<p>Integers constants can be defined in the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>decimal (base 10)</p>
</li>
<li>
<p>octal (base 8)</p>
</li>
<li>
<p>hexadecimal (base 16)</p>
</li>
<li>
<p>scientific (base 10)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Octal constants have to be prefixed with a <code>0</code>, e.g. <code>0123</code>.
Hexadecimal constants start with either <code>0x</code> or <code>0X</code>, e.g. <code>0x10</code>.
Scientific are written in the <code>&lt;m&gt;e&lt;n&gt;</code> format which is a shorthand for <code>m*10^n</code>, e.g. <code>$i = 2e3;</code>.
Note that scientific literals are integer only due to the lack of floating point support, <code>1e-3</code> is not valid.</p>
</div>
<div class="paragraph">
<p>To improve the readability of big literals a underscore <code>_</code> can be used as field separator, e.g. 1_000_123_000.</p>
</div>
<div class="paragraph">
<p>Integer suffixes as found in the C language are parsed by bpftrace to ensure compatibility with C headers/definitions but they&#8217;re not used as size specifiers.
<code>123UL</code>, <code>123U</code> and <code>123LL</code> all result in the same integer type with a value of <code>123</code>.</p>
</div>
<div class="paragraph">
<p>Character constants can be defined by enclosing the character in single quotes, e.g. <code>$c = 'c';</code>.</p>
</div>
<div class="paragraph">
<p>String constants can be defined by enclosing the character string in double quotes, e.g. <code>$str = "Hello world";</code>.</p>
</div>
<div class="paragraph">
<p>Characters and strings support the following escape sequences:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Newline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tab</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\0nn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Octal value nn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">\xnn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hexadecimal value nn</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="language_type_conversion">Type conversion</h3>
<div class="paragraph">
<p>Integer and pointer types can be converted using explicit type conversion with an expression like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$y = (uint32) $z;
$py = (int16 *) $pz;</pre>
</div>
</div>
<div class="paragraph">
<p>Integer casts to a higher rank are sign extended.
Conversion to a lower rank is done by zeroing leading bits.</p>
</div>
</div>
<div class="sect2">
<h3 id="language_operators_and_expressions">Operators and Expressions</h3>
<div class="sect3">
<h4 id="language_arithmetic_operators">Arithmetic Operators</h4>
<div class="paragraph">
<p>The following operators are available for integer arithmetic:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer addition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer subtraction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer multiplication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer division</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer modulo</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="language_logical_operators">Logical Operators</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&amp;&amp;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical AND</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">||</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical OR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical NOT</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="language_bitwise_operators">Bitwise Operators</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&amp;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AND</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">^</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XOR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Left shift the left-hand operand by the number of bits specified by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right shift the left-hand operand by the number of bits specified by the right-hand expression value</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="language_relational_operators">Relational Operators</h4>
<div class="paragraph">
<p>The following relational operators are defined for integers and pointers.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left-hand expression is less than right-hand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left-hand expression is less than or equal to right-hand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left-hand expression is bigger than right-hand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left-hand expression is bigger or equal to than right-hand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">==</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left-hand expression equal to right-hand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left-hand expression not equal to right-hand</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following relation operators are available for comparing strings and integer arrays.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">==</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left-hand string equal to right-hand</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left-hand string not equal to right-hand</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="language_assignment_operators">Assignment Operators</h4>
<div class="paragraph">
<p>The following assignment operators can be used on both <code>map</code> and <code>scratch</code> variables:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assignment, assign the right-hand expression to the left-hand variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update the variable with its value left shifted by the number of bits specified by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update the variable with its value right shifted by the number of bits specified by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Increment the variable by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decrement the variable by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiple the variable by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Divide the variable by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo the variable by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&amp;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise AND the variable by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise OR the variable by the right-hand expression value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">^=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bitwise XOR the variable by the right-hand expression value</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All these operators are syntactic sugar for combining assignment with the specified operator.
<code>@ -= 5</code> is equal to <code>@ = @ - 5</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="language_increment_and_decrement_operators">Increment and Decrement Operators</h4>
<div class="paragraph">
<p>The increment (<code>++</code>) and decrement (<code>--</code>) operators can be used on integer and pointer variables to increment their value by one.
They can only be used on variables and can either be applied as prefix or suffix.
The difference is that the expression <code>x++</code> returns the original value of <code>x</code>, before it got incremented while <code>++x</code> returns the value of <code>x</code> post increment.
E.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$x = 10;
$y = $x--; // y = 10; x = 9
$a = 10;
$b = --$a; // a = 9; b = 9</pre>
</div>
</div>
<div class="paragraph">
<p>Note that maps will be implicitly declared and initialized to 0 if not already declared or defined.
Scratch variables must be initialized before using these operators.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="language_variables_and_maps">Variables and Maps</h3>
<div class="paragraph">
<p>bpftrace knows two types of variables, <code>scratch</code> and <code>map</code>.</p>
</div>
<div class="paragraph">
<p>'scratch' variables are kept on the BPF stack and only exists during the execution of the action block and cannot be accessed outside of the program.
Scratch variable names always start with a <code>$</code>, e.g. <code>$myvar</code>.</p>
</div>
<div class="paragraph">
<p>'map' variables use BPF 'maps'.
These exist for the lifetime of <code>bpftrace</code> itself and can be accessed from all action blocks and user-space.
Map names always start with a <code>@</code>, e.g. <code>@mymap</code>.</p>
</div>
<div class="paragraph">
<p>All valid identifiers can be used as <code>name</code>.</p>
</div>
<div class="paragraph">
<p>The data type of a variable is automatically determined during first assignment and cannot be changed afterwards.</p>
</div>
<div class="sect3">
<h4 id="language_associative_arrays">Associative Arrays</h4>
<div class="paragraph">
<p>Associative arrays are a collection of elements indexed by a key, similar to the hash tables found in languages like C++ (<code>std::map</code>) and Python (<code>dict</code>).
They&#8217;re a variant of 'map' variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@name[key] = expression
@name[key1,key2] = expression</pre>
</div>
</div>
<div class="paragraph">
<p>Just like with any variable the type is determined on first use and cannot be modified afterwards.
This applies to both the key(s) and the value type.</p>
</div>
<div class="paragraph">
<p>The following snippet creates a map with key signature <code>[int64, string[16]]</code> and a value type of <code>int64</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@[pid, comm]++</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="language_variable_scoping">Variable scoping</h3>

</div>
<div class="sect2">
<h3 id="language_pointers">Pointers</h3>
<div class="paragraph">
<p>Pointers in bpftrace are similar to those found in <code>C</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="language_tuples">Tuples</h3>
<div class="paragraph">
<p>bpftrace has support for immutable N-tuples (<code>n &gt; 1</code>).
A tuple is a sequence type (like an array) where, unlike an array, every element can have a different type.</p>
</div>
<div class="paragraph">
<p>Tuples are a comma separated list of expressions, enclosed in brackets, <code>(1,2)</code>
Individual fields can be accessed with the <code>.</code> operator.
Tuples are zero indexed like arrays are.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:s:1 {
  $a = (1,2);
  $b = (3,4, $a);
  print($a);
  print($b);
  print($b.0);
}</pre>
</div>
</div>
<div class="paragraph">
<p>Prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(1, 2)
(3, 4, (1, 2))
3</pre>
</div>
</div>
<div class="sect3">
<h4 id="language_arrays">Arrays</h4>
<div class="paragraph">
<p>bpftrace supports accessing one-dimensional arrays like those found in <code>C</code>.</p>
</div>
<div class="paragraph">
<p>Constructing arrays from scratch, like <code>int a[] = {1,2,3}</code> in <code>C</code>, is not supported.
They can only be read into a variable from a pointer.</p>
</div>
<div class="paragraph">
<p>The <code>[]</code> operator is used to access elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct MyStruct {
  int y[4];
}

kprobe:dummy {
  $s = (struct MyStruct *) arg0;
  print($s-&gt;y[0]);
}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="language_structs">Structs</h3>
<div class="paragraph">
<p><code>C</code> like structs are supported by bpftrace.
Fields are accessed with the <code>.</code> operator.
Fields of a pointer to a struct can be accessed with the <code>-&gt;</code> operator.</p>
</div>
<div class="paragraph">
<p>Custom struct can be defined in the preamble</p>
</div>
<div class="paragraph">
<p>Constructing structs from scratch, like <code>struct X var = {.f1 = 1}</code> in <code>C</code>, is not supported.
They can only be read into a variable from a pointer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>struct MyStruct {
  int a;
}

kprobe:dummy {
  $ptr = (struct MyStruct *) arg0;
  $st = *$ptr;
  print($st.a);
  print($ptr-&gt;a);
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="language_conditionals">Conditionals</h3>
<div class="paragraph">
<p>Conditional expressions are supported in the form of if/else statements and the ternary operator.</p>
</div>
<div class="paragraph">
<p>The ternary operator consists of three operands: a condition followed by a <code>?</code>, the expression to execute when the condition is true followed by a <code>:</code> and the expression to execute if the condition is false.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>condition ? ifTrue : ifFalse</pre>
</div>
</div>
<div class="paragraph">
<p>Both the <code>ifTrue</code> and <code>ifFalse</code> expressions must be of the same type, mixing types is not allowed.</p>
</div>
<div class="paragraph">
<p>The ternary operator can be used as part of an assignment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$a == 1 ? print("true") : print("false");
$b = $a &gt; 0 ? $a : -1;</pre>
</div>
</div>
<div class="paragraph">
<p>If/else statements, like the one in <code>C</code>, are supported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if (condition) {
  ifblock
} else if (condition) {
  if2block
} else {
  elseblock
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="language_loops">Loops</h3>
<div class="paragraph">
<p>Since kernel 5.3 BPF supports loops as long as the verifier can prove they&#8217;re bounded and fit within the instruction limit.</p>
</div>
<div class="paragraph">
<p>In bpftrace loops are available through the <code>while</code> statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>while (condition) {
  block;
}</pre>
</div>
</div>
<div class="paragraph">
<p>Within a while-loop the following control flow statements can be used:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">continue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">skip processing of the rest of the block and jump back to the evaluation of the conditional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">break</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Terminate the loop</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre>i:s:1 {
  $i = 0;
  while ($i &lt;= 100) {
    printf("%d ", $i);
    if ($i &gt; 5) {
      break;
    }
    $i++
  }
  printf("\n");
}</pre>
</div>
</div>
<div class="paragraph">
<p>Loop unrolling is also supported with the <code>unroll</code> statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>unroll(n) {
  block;
}</pre>
</div>
</div>
<div class="paragraph">
<p>The compiler will evaluate the block <code>n</code> times and generate the BPF code for the block <code>n</code> times.
As this happens at compile time <code>n</code> must be a constant greater than 0 (<code>n &gt; 0</code>).</p>
</div>
<div class="paragraph">
<p>The following two probes compile into the same code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:s:1 {
  unroll(3) {
    print("Unrolled")
  }
}

i:s:1 {
  print("Unrolled")
  print("Unrolled")
  print("Unrolled")
}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_invocation_mode">Invocation Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are three invocation modes for bpftrace built-in functions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Example functions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value/effect of the built-in function is determined/handled right away by the bpf program in the kernel space.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reg(), str(), ntop()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asynchronous</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value/effect of the built-in function is determined/handled later by the bpftrace process in the user space.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>printf(), clear(), exit()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compile-time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value of the built-in function is determined before bpf programs are running.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kaddr(), cgroupid(), offsetof()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>While BPF in the kernel can do a lot there are still things that can only be done from user space, like the outputting (printing) of data.
The way bpftrace handles this is by sending events from the BPF program which user-space will pick up some time in the future (usually in milliseconds).
Operations that happen in the kernel are 'synchronous' ('sync') and those that are handled in user space are 'asynchronous' ('async')</p>
</div>
<div class="paragraph">
<p>The asynchronous behaviour can lead to some unexpected behavior as updates can happen before user space had time to process the event. The following situations may occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>event loss: when using printf(), the amount of data printed may be less than the actual number of events generated by the kernel during BPF program&#8217;s execution.</p>
</li>
<li>
<p>delayed exit: when using the exit() to terminate the program, bpftrace needs to handle the exit signal asynchronously casuing the BPF program may continue to run for some additional time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One example is updating a map value in a tight loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>BEGIN {
    @=0;
    unroll(10) {
      print(@);
      @++;
    }
    exit()
}</pre>
</div>
</div>
<div class="paragraph">
<p>Maps are printed by reference not by value and as the value gets updated right after the print user-space will likely only see the final value once it processes the event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@: 10
@: 10
@: 10
@: 10
@: 10
@: 10
@: 10
@: 10
@: 10
@: 10</pre>
</div>
</div>
<div class="paragraph">
<p>Therefore, when you need precise event statistics, it is recommended to use synchronous functions (e.g. count() and hist()) to ensure more reliable and accurate results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_address_spaces">Address-spaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kernel and user pointers live in different address spaces which, depending on the CPU architecture, might overlap.
Trying to read a pointer that is in the wrong address space results in a runtime error.
This error is hidden by default but can be enabled with the <code>-kk</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>stdin:1:9-12: WARNING: Failed to probe_read_user: Bad address (-14)
BEGIN { @=*uptr(kaddr("do_poweroff")) }
        ~~~</pre>
</div>
</div>
<div class="paragraph">
<p>bpftrace tries to automatically set the correct address space for a pointer based on the probe type, but might fail in cases where it is unclear.
The address space can be changed with the <code>kptr()</code> and <code>uptr()</code> functions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_builtins">Builtins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Builtins are special variables built into the language.
Unlike the scratch and map variable they don&#8217;t need a <code>$</code> or <code>@</code> as prefix (except for the positional parameters).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Kernel</th>
<th class="tableblock halign-left valign-top">BPF Helper</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$1</code>, <code>$2</code>, <code>&#8230;&#8203;$n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The nth positional parameter passed to the bpftrace program.
If less than n parameters are passed this evaluates to <code>0</code>.
For string arguments use the <code>str()</code> call to retrieve the value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$#</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of positional parameters passed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>arg0</code>, <code>arg1</code>, <code>&#8230;&#8203;argn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nth argument passed to the function being traced. These are extracted from the CPU registers. The amount of args passed in registers depends on the CPU architecture. (kprobes, uprobes, usdt).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>args</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">struct args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The struct of all arguments of the traced function. Available in <code>tracepoint</code>, <code>kfunc</code>, and <code>uprobe</code> (with DWARF) probes. Use <code>args.x</code> to access argument <code>x</code> or <code>args</code> to get a record with all arguments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cgroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_current_cgroup_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the cgroup the current task is in. Only works with cgroupv2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">comm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string[16]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_current_com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>comm</code> of the current task. Equal to the value in <code>/proc/&lt;pid&gt;/comm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PID of the child process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numaid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">numa_node_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the NUMA node executing the BPF program</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw_smp_processor_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the processor executing the BPF program</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">curtask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_current_task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointer to <code>struct task_struct</code> of the current task</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">elapsed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(see nsec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ktime_get_ns / ktime_get_boot_ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nanoseconds elapsed since bpftrace initialization, based on <code>nsecs</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">func</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the current function being traced (kprobes,uprobes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_current_uid_gid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GID of current task</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kstack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kstack</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_stackid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kernel stack trace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nsecs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.1 / 5.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ktime_get_ns / ktime_get_boot_ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nanoseconds since kernel boot. On kernels that support <code>ktime_get_boot_ns</code> this includes the time spent suspended, on older kernels it does not.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_current_pid_tgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process ID (or thread group ID) of the current task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">probe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/na</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the current probe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rand</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_prandom_u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Random number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value returned by the function being traced (kretprobe, uretprobe, kretfunc)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sarg0</code>, <code>sarg1</code>, <code>&#8230;&#8203;sargn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nth stack value of the function being traced. (kprobes, uprobes).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_current_pid_tgid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thread ID of the current task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uint64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_current_uid_gid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UID of current task</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ustack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ustack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_stackid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Userspace stack trace</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="functions_map_functions">Map Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Map functions are built-in functions who&#8217;s return value can only be assigned to maps.
The data type associated with these functions are only for internal use and are not compatible with the (integer) operators.</p>
</div>
<div class="paragraph">
<p>Functions that are marked <strong>async</strong> are asynchronous which can lead to unexpected behavior, see the <a href="#Sync and Async">[Sync and Async]</a> section for more information.</p>
</div>
<div class="sect2">
<h3 id="functions_avg">avg</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>avg(int64 n)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Calculate the running average of <code>n</code> between consecutive calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:s:1 {
  @x++;
  @y = avg(@x);
  print(@x);
  print(@y);
}</pre>
</div>
</div>
<div class="paragraph">
<p>Internally this keeps two values in the map: value count and running total.
The average is computed in user-space when printing by dividing the total by the count.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_clear">clear</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>clear(map m)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p>Clear all keys/values from map <code>m</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:ms:100 {
  @[rand % 10] = count();
}

i:s:10 {
  print(@);
  clear(@);
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_count">count</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>count()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Count how often this function is called.</p>
</div>
<div class="paragraph">
<p>Using <code>@=count()</code> is conceptually similar to <code>@++</code>.
The difference is that the <code>count()</code> function uses a map type optimized for this (PER_CPU), increasing performance.
Due to this the map cannot be accessed as a regular integer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:ms:100 {
  @ = count();
}

i:s:10 {
  print(@);
  clear(@);
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_delete">delete</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>delete(mapkey k)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Delete a single key from a map.
For a single value map this deletes the only element.
For an associative-array the key to delete has to be specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>k:dummy {
  @scalar = 1;
  @associative[1,2] = 1;
  delete(@scalar);
  delete(@associative[1,2]);

  delete(@associative); // error
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_hist">hist</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>hist(int64 n)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create a log2 histogram of <code>n</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kretprobe:vfs_read {
  @bytes = hist(retval);
}</pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@:
[1M, 2M)               3 |                                                    |
[2M, 4M)               2 |                                                    |
[4M, 8M)               2 |                                                    |
[8M, 16M)              6 |                                                    |
[16M, 32M)            16 |                                                    |
[32M, 64M)            27 |                                                    |
[64M, 128M)           48 |@                                                   |
[128M, 256M)          98 |@@@                                                 |
[256M, 512M)         191 |@@@@@@                                              |
[512M, 1G)           394 |@@@@@@@@@@@@@                                       |
[1G, 2G)             820 |@@@@@@@@@@@@@@@@@@@@@@@@@@@                         |</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_lhist">lhist</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>lhist(int64 n, int64 min, int64 max, int64 step)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create a linear histogram of <code>n</code>.
<code>lhist</code> creates <code>M</code> (<code>(max - min) / step</code>) buckets in the range <code>[min,max)</code> where each bucket is <code>step</code> in size.
Values in the range <code>(-inf, min)</code> and <code>(max, inf)</code> get their get their own bucket too, bringing the total amount of buckets created to <code>M+2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:ms:1 {
  @ = lhist(rand %10, 0, 10, 1);
}

i:s:5 {
  exit();
}</pre>
</div>
</div>
<div class="paragraph">
<p>Prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@:
[0, 1)               306 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         |
[1, 2)               284 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@            |
[2, 3)               294 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@          |
[3, 4)               318 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       |
[4, 5)               311 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@        |
[5, 6)               362 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@|
[6, 7)               336 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    |
[7, 8)               326 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      |
[8, 9)               328 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     |
[9, 10)              318 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       |</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_max">max</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>max(int64 n)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Update the map with <code>n</code> if <code>n</code> is bigger than the current value held.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_min">min</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>min(int64 n)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Update the map with <code>n</code> if <code>n</code> is smaller than the current value held.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_stats">stats</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>stats(int64 n)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>stats</code> combines the <code>count</code>, <code>avg</code> and <code>sum</code> calls into one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:vfs_read {
  @bytes[comm] = stats(arg2);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>@bytes[bash]: count 7, average 1, total 7
@bytes[sleep]: count 5, average 832, total 4160
@bytes[ls]: count 7, average 886, total 6208
@</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_sum">sum</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>sum(int64 n)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Calculate the sum of all <code>n</code> passed.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_zero">zero</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>zero(map m)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p>Set all values for all keys to zero.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="functions_functions">Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Functions that are marked <strong>async</strong> are asynchronous which can lead to unexpected behaviour, see the <a href="#sync and async">[sync and async]</a> section for more information.</p>
</div>
<div class="paragraph">
<p><strong>compile time</strong> functions are evaluated at compile time, a static value will be compiled into the program.</p>
</div>
<div class="paragraph">
<p><strong>unsafe</strong> functions can have dangerous side effects and should be used with care, the <code>--unsafe</code> flag is required for use.</p>
</div>
<div class="sect2">
<h3 id="functions_bswap">bswap</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>uint8 bswap(uint8 n)</code></p>
</li>
<li>
<p><code>uint16 bswap(uint16 n)</code></p>
</li>
<li>
<p><code>uint32 bswap(uint32 n)</code></p>
</li>
<li>
<p><code>uint64 bswap(uint64 n)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>bswap</code> reverses the order of the bytes in integer <code>n</code>. In case of 8 bit integers, <code>n</code> is returned without being modified.
The return type is an unsigned integer of the same width as <code>n</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_buf">buf</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>buf_t buf(void * data, [int64 length])</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>buf</code> reads <code>length</code> amount of bytes from address <code>data</code>.
The maximum value of <code>length</code> is limited to the <code>BPFTRACE_STRLEN</code> variable.
For arrays the <code>length</code> is optional, it is automatically inferred from the signature.</p>
</div>
<div class="paragraph">
<p><code>buf</code> is address space aware and will call the correct helper based on the address space associated with <code>data</code>.</p>
</div>
<div class="paragraph">
<p>The <code>buf_t</code> object returned by <code>buf</code> can safely be printed as a hex encoded string with the <code>%r</code> format specifier.</p>
</div>
<div class="paragraph">
<p>Bytes with values &gt;=32 and &lt;=126 are printed using their ASCII character, other bytes are printed in hex form (e.g. <code>\x00</code>). The <code>%rx</code> format specifier can be used to print everything in hex form, including ASCII characters. The similar <code>%rh</code> format specifier prints everything in hex form without <code>\x</code> and with spaces between bytes (e.g. <code>0a fe</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:s:1 {
  printf("%r\n", buf(kaddr("avenrun"), 8));
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>\x00\x03\x00\x00\x00\x00\x00\x00
\xc2\x02\x00\x00\x00\x00\x00\x00</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_cat">cat</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void cat(string namefmt, [&#8230;&#8203;args])</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p>Dump the contents of the named file to stdout.
<code>cat</code> supports the same format string and arguments that <code>printf</code> does.
If the file cannot be opened or read an error is printed to stderr.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>t:syscalls:sys_enter_execve {
  cat("/proc/%d/maps", pid);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>55f683ebd000-55f683ec1000 r--p 00000000 08:01 1843399                    /usr/bin/ls
55f683ec1000-55f683ed6000 r-xp 00004000 08:01 1843399                    /usr/bin/ls
55f683ed6000-55f683edf000 r--p 00019000 08:01 1843399                    /usr/bin/ls
55f683edf000-55f683ee2000 rw-p 00021000 08:01 1843399                    /usr/bin/ls
55f683ee2000-55f683ee3000 rw-p 00000000 00:00 0</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_cgroup_path">cgroup_path</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>cgroup_path cgroup_path(int cgroupid, string filter)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Convert cgroup id to cgroup path.
This is done asynchronously in userspace when the cgroup_path value is printed,
therefore it can resolve to a different value if the cgroup id gets reassigned.
This also means that the returned value can only be used for printing.</p>
</div>
<div class="paragraph">
<p>A string literal may be passed as an optional second argument to filter cgroup
hierarchies in which the cgroup id is looked up by a wildcard expression (cgroup2
is always represented by "unified", regardless of where it is mounted).</p>
</div>
<div class="paragraph">
<p>The currently mounted hierarchy at /sys/fs/cgroup is used to do the lookup. If
the cgroup with the given id isn&#8217;t present here (e.g. when running in a Docker
container), the cgroup path won&#8217;t be found (unlike when looking up the cgroup
path of a process via /proc/&#8230;&#8203;/cgroup).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>BEGIN {
  $cgroup_path = cgroup_path(3436);
  print($cgroup_path);
  print($cgroup_path); /* This may print a different path */
  printf("%s %s", $cgroup_path, $cgroup_path); /* This may print two different paths */
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_cgroupid">cgroupid</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>uint64 cgroupid(const string path)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>compile time</strong></p>
</div>
<div class="paragraph">
<p><code>cgroupid</code> retrieves the cgroupv2 ID  of the cgroup available at <code>path</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>BEGIN {
  print(cgroupid("/sys/fs/cgroup/system.slice"));
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_exit">exit</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void exit()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p>Terminate bpftrace, as if a <code>SIGTERM</code> was received.
The <code>END</code> probe will still trigger (if specified) and maps will be printed.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_join">join</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void join(char *arr[], [char * sep = ' '])</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p><code>join</code> joins all the string array <code>arr</code> with <code>sep</code> as separator into one string.
This string will be printed to stdout directly, it cannot be used as string value.</p>
</div>
<div class="paragraph">
<p>The concatenation of the array members is done in BPF and the printing happens in userspace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tracepoint:syscalls:sys_enter_execve {
  join(args.argv);
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_kaddr">kaddr</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>uint64 kaddr(const string name)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>compile time</strong></p>
</div>
<div class="paragraph">
<p>Get the address of the kernel symbol <code>name</code>.</p>
</div>
<div class="paragraph">
<p>The following script:</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_kptr">kptr</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>T * kptr(T * ptr)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Marks <code>ptr</code> as a kernel address space pointer.
See the address-spaces section for more information on address-spaces.
The pointer type is left unchanged.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_ksym">ksym</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>ksym_t ksym(uint64 addr)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p>Retrieve the name of the function that contains address <code>addr</code>.
The address to name mapping happens in user-space.</p>
</div>
<div class="paragraph">
<p>The <code>ksym_t</code> type can be printed with the <code>%s</code> format specifier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:do_nanosleep
{
  printf("%s\n", ksym(reg("ip")));
}</pre>
</div>
</div>
<div class="paragraph">
<p>Prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>do_nanosleep</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_macaddr">macaddr</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>macaddr_t macaddr(char [6] mac)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create a buffer that holds a macaddress as read from <code>mac</code>
This buffer can be printed in the canonical string format using the <code>%s</code> format specifier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:arp_create {
  printf("SRC %s, DST %s\n", macaddr(sarg0), macaddr(sarg1));
}</pre>
</div>
</div>
<div class="paragraph">
<p>Prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SRC 18:C0:4D:08:2E:BB, DST 74:83:C2:7F:8C:FF</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_ntop">ntop</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>inet_t ntop([int64 af, ] int addr)</code></p>
</li>
<li>
<p><code>inet_t ntop([int64 af, ] char addr[4])</code></p>
</li>
<li>
<p><code>inet_t ntop([int64 af, ] char addr[16])</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>ntop</code> returns the string representation of an IPv4 or IPv6 address.
<code>ntop</code> will infer the address type (IPv4 or IPv6) based on the <code>addr</code> type and size.
If an integer or <code>char[4]</code> is given, ntop assumes IPv4, if a <code>char[16]</code> is given, ntop assumes IPv6.
You can also pass the address type (e.g. AF_INET) explicitly as the first parameter.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_pton">pton</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>char addr[4] pton(const string *addr_v4)</code></p>
</li>
<li>
<p><code>char addr[16] pton(const string *addr_v6)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>compile time</strong></p>
</div>
<div class="paragraph">
<p><code>pton</code> converts a text representation of an IPv4 or IPv6 address to byte array.
<code>pton</code> infers the address family based on <code>.</code> or <code>:</code> in the given argument.
<code>pton</code> comes in handy when we need to select packets with certain IP addresses.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_override">override</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>override(uint64 rc)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>unsafe</strong></p>
</div>
<div class="paragraph">
<p><strong>Kernel</strong> 4.16</p>
</div>
<div class="paragraph">
<p><strong>Helper</strong> <code>bpf_override</code></p>
</div>
<div class="ulist">
<div class="title">Supported probes</div>
<ul>
<li>
<p>kprobe</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using <code>override</code> the probed function will not be executed and instead <code>rc</code> will be returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>k:__x64_sys_getuid
/comm == "id"/ {
  override(2&lt;&lt;21);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>uid=4194304 gid=0(root) euid=0(root) groups=0(root)</pre>
</div>
</div>
<div class="paragraph">
<p>This feature only works on kernels compiled with <code>CONFIG_BPF_KPROBE_OVERRIDE</code> and only works on functions tagged <code>ALLOW_ERROR_INJECTION</code>.</p>
</div>
<div class="paragraph">
<p>bpftrace does not test whether error injection is allowed for the probed function, instead if will fail to load the program into the kernel:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ioctl(PERF_EVENT_IOC_SET_BPF): Invalid argument
Error attaching probe: 'kprobe:vfs_read'</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_reg">reg</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>reg(const string name)</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Supported probes</div>
<ul>
<li>
<p>kprobe</p>
</li>
<li>
<p>uprobe</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Get the contents of the register identified by <code>name</code>.
Valid names depend on the CPU architecture.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_signal">signal</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>signal(const string sig)</code></p>
</li>
<li>
<p><code>signal(uint32 signum)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>unsafe</strong></p>
</div>
<div class="paragraph">
<p><strong>Kernel</strong> 5.3</p>
</div>
<div class="paragraph">
<p><strong>Helper</strong> <code>bpf_send_signal</code></p>
</div>
<div class="paragraph">
<p>Probe types: k(ret)probe, u(ret)probe, USDT, profile</p>
</div>
<div class="paragraph">
<p>Send a signal to the process being traced.
The signal can either be identified by name, e.g. <code>SIGSTOP</code> or by ID, e.g. <code>19</code> as found in <code>kill -l</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:__x64_sys_execve
/comm == "bash"/ {
  signal(5);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ls
Trace/breakpoint trap (core dumped)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_sizeof">sizeof</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>sizeof(TYPE)</code></p>
</li>
<li>
<p><code>sizeof(EXPRESSION)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>compile time</strong></p>
</div>
<div class="paragraph">
<p>Returns size of the argument in bytes.
Similar to C/C++ <code>sizeof</code> operator.
Note that the expression does not get evaluated.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_offsetof">offsetof</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>offsetof(STRUCT, FIELD)</code></p>
</li>
<li>
<p><code>offsetof(EXPRESSION, FIELD)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>compile time</strong></p>
</div>
<div class="paragraph">
<p>Returns offset of the field offset bytes in struct.
Similar to kernel <code>offsetof</code> operator.
Note that subfields are not yet supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_str">str</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>str(char * data [, uint32 length)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Helper</strong> <code>probe_read_str, probe_read_{kernel,user}_str</code></p>
</div>
<div class="paragraph">
<p><code>str</code> reads a NULL terminated (<code>\0</code>) string from <code>data</code>.
The maximum string length is limited by the <code>BPFTRACE_STR_LEN</code> env variable, unless <code>length</code> is specified and shorter than the maximum.
In case the string is longer than the specified length only <code>length - 1</code> bytes are copied and a NULL byte is appended at the end.</p>
</div>
<div class="paragraph">
<p>When available (starting from kernel 5.5, see the <code>--info</code> flag) bpftrace will automatically use the <code>kernel</code> or <code>user</code> variant of <code>probe_read_{kernel,user}_str</code> based on the address space of <code>data</code>, see <a href="#_address_spaces">Address-spaces</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_strerror">strerror</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>strerror strerror(int error)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Convert errno code to string.
This is done asynchronously in userspace when the strerror value is printed, hence the returned value can only be used for printing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#include &lt;errno.h&gt;
BEGIN {
  print(strerror(EPERM));
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_strftime">strftime</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>strtime_t strftime(const string fmt, int64 timestamp_ns)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p>Format the nanoseconds since boot timestamp <code>timestamp_ns</code> according to the format specified by <code>fmt</code>.
The time conversion and formatting happens in user space, therefore  the <code>timestr_t</code> value returned can only be used for printing using the <code>%s</code> format specifier.</p>
</div>
<div class="paragraph">
<p>bpftrace uses the <code>strftime(3)</code> function for formatting time and supports the same format specifiers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:s:1 {
  printf("%s\n", strftime("%H:%M:%S", nsecs));
}</pre>
</div>
</div>
<div class="paragraph">
<p>bpftrace also supports the following format string extensions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Specifier</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Microsecond as a decimal number, zero-padded on the left</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="functions_strncmp">strncmp</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>int64 strncmp(char * s1, char * s2, int64 n)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>strncmp</code> compares up to <code>n</code> characters string <code>s1</code> and string <code>s2</code>.
If they&#8217;re equal <code>0</code> is returned, else a non-zero value is returned.</p>
</div>
<div class="paragraph">
<p>bpftrace doesn&#8217;t read past the length of the shortest string.</p>
</div>
<div class="paragraph">
<p>The use of the <code>==</code> and <code>!=</code> operators is recommended over calling <code>strncmp</code> directly.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_strcontains">strcontains</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>int64 strcontains(const char *haystack, const char *needle)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>strcontains</code> compares whether the string haystack contains the string needle.
If needle is contained <code>1</code> is returned, else zero is returned.</p>
</div>
<div class="paragraph">
<p>bpftrace doesn&#8217;t read past the length of the shortest string.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_system">system</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void system(string namefmt [, &#8230;&#8203;args])</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>unsafe</strong>
<strong>async</strong></p>
</div>
<div class="paragraph">
<p><code>system</code> lets bpftrace run the specified command (<code>fork</code> and <code>exec</code>) until it completes and print its stdout.
The <code>command</code> is run with the same privileges as bpftrace and it blocks execution of the processing threads which can lead to missed events and delays processing of async events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:s:1 {
  time("%H:%M:%S: ");
  printf("%d\n", @++);
}
i:s:10 {
  system("/bin/sleep 10");
}
i:s:30 {
  exit();
}</pre>
</div>
</div>
<div class="paragraph">
<p>Note how the async <code>time</code> and <code>printf</code> first print every second until the <code>i:s:10</code> probe hits, then they print every 10 seconds due to bpftrace blocking on <code>sleep</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Attaching 3 probes...
08:50:37: 0
08:50:38: 1
08:50:39: 2
08:50:40: 3
08:50:41: 4
08:50:42: 5
08:50:43: 6
08:50:44: 7
08:50:45: 8
08:50:46: 9
08:50:56: 10
08:50:56: 11
08:50:56: 12
08:50:56: 13
08:50:56: 14
08:50:56: 15
08:50:56: 16
08:50:56: 17
08:50:56: 18
08:50:56: 19</pre>
</div>
</div>
<div class="paragraph">
<p><code>system</code> supports the same format string and arguments that <code>printf</code> does.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>t:syscalls:sys_enter_execve {
  system("/bin/grep %s /proc/%d/status", "vmswap", pid);
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_time">time</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void time(const string fmt)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p>Format the current wall time according to the format specifier <code>fmt</code> and print it to stdout.
Unlike <code>strftime()</code> <code>time()</code> doesn&#8217;t send a timestamp from the probe, instead it is the time at which user-space processes the event.</p>
</div>
<div class="paragraph">
<p>bpftrace uses the <code>strftime(3)</code> function for formatting time and supports the same format specifiers.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_uaddr">uaddr</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>T * uaddr(const string sym)</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Supported probes</div>
<ul>
<li>
<p>uprobes</p>
</li>
<li>
<p>uretprobes</p>
</li>
<li>
<p>USDT</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Does not work with ASLR, see issue <a href="https://github.com/iovisor/bpftrace/issues/75">#75</a></strong></p>
</div>
<div class="paragraph">
<p>The <code>uaddr</code> function returns the address of the specified symbol.
This lookup happens during program compilation and cannot be used dynamically.</p>
</div>
<div class="paragraph">
<p>The default return type is <code>uint64*</code>.
If the ELF object size matches a known integer size (1, 2, 4 or 8 bytes) the return type is modified to match the width (<code>uint8*</code>, <code>uint16*</code>, <code>uint32*</code> or <code>uint64*</code> resp.).
As ELF does not contain type info the type is always assumed to be unsigned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>uprobe:/bin/bash:readline {
  printf("PS1: %s\n", str(*uaddr("ps1_prompt")));
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_uptr">uptr</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>T * uptr(T * ptr)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Marks <code>ptr</code> as a user address space pointer.
See the address-spaces section for more information on address-spaces.
The pointer type is left unchanged.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_usym">usym</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>usym_t usym(uint64 * addr)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="ulist">
<div class="title">Supported probes</div>
<ul>
<li>
<p>uprobes</p>
</li>
<li>
<p>uretprobes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Equal to <a href="#functions_ksym">ksym</a> but resolves user space symbols.</p>
</div>
<div class="paragraph">
<p>If ASLR is enabled, user space symbolication only works when the process is running at either the time of the symbol resolution or the time of the probe attachment. The latter requires <code>BPFTRACE_CACHE_USER_SYMBOLS</code> to be set to <code>PER_PID</code>, and might not work with older versions of BCC. A similar limitation also applies to dynamically loaded symbols.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>uprobe:/bin/bash:readline
{
  printf("%s\n", usym(reg("ip")));
}</pre>
</div>
</div>
<div class="paragraph">
<p>Prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>readline</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_path">path</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>char * path(struct path * path)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Kernel</strong> 5.10</p>
</div>
<div class="paragraph">
<p><strong>Helper</strong> bpf_d_path</p>
</div>
<div class="paragraph">
<p>Return full path referenced by struct path pointer in argument.</p>
</div>
<div class="paragraph">
<p>This function can only be used by functions that are allowed to, these functions are contained in the <code>btf_allowlist_d_path</code> set in the kernel.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_unwatch">unwatch</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void unwatch(void * addr)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p>Removes a watchpoint</p>
</div>
</div>
<div class="sect2">
<h3 id="functions_skboutput">skboutput</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>uint32 skboutput(const string path, struct sk_buff *skb, uint64 length, const uint64 offset)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Kernel</strong> 5.5</p>
</div>
<div class="paragraph">
<p><strong>Helper</strong> bpf_skb_output</p>
</div>
<div class="paragraph">
<p>Write sk_buff <code>skb</code> 's data section to a PCAP file in the <code>path</code>, starting from <code>offset</code> to <code>offset</code> + <code>length</code>.</p>
</div>
<div class="paragraph">
<p>The PCAP file is encapsulated in RAW IP, so no ethernet header is included.
The <code>data</code> section in the struct <code>skb</code> may contain ethernet header in some kernel contexts, you may set <code>offset</code> to 14 bytes to exclude ethernet header.</p>
</div>
<div class="paragraph">
<p>Each packet&#8217;s timestamp is determined by adding <code>nsecs</code> and boot time, the accuracy varies on different kernels, see <code>nsecs</code>.</p>
</div>
<div class="paragraph">
<p>This function returns 0 on success, or a negative error in case of failure.</p>
</div>
<div class="paragraph">
<p>Environment variable <code>BPFTRACE_PERF_RB_PAGES</code> should be increased in order to capture large packets, or else these packets will be dropped.</p>
</div>
<div class="paragraph">
<p>Usage</p>
</div>
<div class="listingblock">
<div class="content">
<pre># cat dump.bt
kfunc:napi_gro_receive {
  $ret = skboutput("receive.pcap", args.skb, args.skb-&gt;len, 0);
}

kfunc:dev_queue_xmit {
  // setting offset to 14, to exclude ethernet header
  $ret = skboutput("output.pcap", args.skb, args.skb-&gt;len, 14);
  printf("skboutput returns %d\n", $ret);
}

# export BPFTRACE_PERF_RB_PAGES=1024
# bpftrace dump.bt
...

# tcpdump -n -r ./receive.pcap  | head -3
reading from file ./receive.pcap, link-type RAW (Raw IP)
dropped privs to tcpdump
10:23:44.674087 IP 22.128.74.231.63175 &gt; 192.168.0.23.22: Flags [.], ack 3513221061, win 14009, options [nop,nop,TS val 721277750 ecr 3115333619], length 0
10:23:45.823194 IP 100.101.2.146.53 &gt; 192.168.0.23.46619: 17273 0/1/0 (130)
10:23:45.823229 IP 100.101.2.146.53 &gt; 192.168.0.23.46158: 45799 1/0/0 A 100.100.45.106 (60)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="functions_output_formatting">Output formatting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="functions_print">print</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void print(T val)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void print(T val)</code></p>
</li>
<li>
<p><code>void print(@map)</code></p>
</li>
<li>
<p><code>void print(@map, uint64 top)</code></p>
</li>
<li>
<p><code>void print(@map, uint64 top, uint64 div)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>print</code> prints a the value, which can be a map or a scalar value, with the default formatting for the type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>i:ms:10 { @=hist(rand); }
i:s:1 {
  print(@);
  print(123);
  print("abc");
  exit();
}</pre>
</div>
</div>
<div class="paragraph">
<p>Prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@:
[16M, 32M)             3 |@@@                                                 |
[32M, 64M)             2 |@@                                                  |
[64M, 128M)            1 |@                                                   |
[128M, 256M)           4 |@@@@                                                |
[256M, 512M)           3 |@@@                                                 |
[512M, 1G)            14 |@@@@@@@@@@@@@@                                      |
[1G, 2G)              22 |@@@@@@@@@@@@@@@@@@@@@@                              |
[2G, 4G)              51 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@|

123
abc</pre>
</div>
</div>
<div class="paragraph">
<p>Note that maps are printed by reference while scalar values are copied.
This means that updating and printing maps in a fast loop will likely result in bogus map values as the map will be updated before userspace gets the time to dump and print it.</p>
</div>
<div class="paragraph">
<p>The printing of maps supports the optional <code>top</code> and <code>div</code> arguments.
<code>top</code> limits the printing to the top N entries with the highest integer values</p>
</div>
<div class="listingblock">
<div class="content">
<pre>BEGIN {
  $i = 11;
  while($i) {
    @[$i] = --$i;
  }
  print(@, 2);
  clear(@);
  exit()
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>@[9]: 9
@[10]: 10</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>div</code> argument scales the values prior to printing them.
Scaling values before storing them can result in rounding errors.
Consider the following program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>k:f {
  @[func] += arg0/10;
}</pre>
</div>
</div>
<div class="paragraph">
<p>With the following sequence as numbers for arg0: <code>134, 377, 111, 99</code>.
The total is <code>721</code> which rounds to <code>72</code> when scaled by 10 but the program would print <code>70</code> due to the rounding of individual values.</p>
</div>
<div class="paragraph">
<p>Changing the print call to <code>print(@, 5, 2)</code> will take the top 5 values and scale them by 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@[6]: 3
@[7]: 3
@[8]: 4
@[9]: 4
@[10]: 5</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions_printf">printf</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>void printf(const string fmt, args&#8230;&#8203;)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>async</strong></p>
</div>
<div class="paragraph">
<p><code>printf()</code> formats and prints data.
It behaves similar to <code>printf()</code> found in <code>C</code> and many other languages.</p>
</div>
<div class="paragraph">
<p>The format string has to be a constant, it cannot be modified at runtime.
The formatting of the string happens in user space.
Values are copied and passed by value.</p>
</div>
<div class="paragraph">
<p>bpftrace supports all the typical format specifiers like <code>%llx</code> and <code>%hhu</code>.
The non-standard ones can be found in the table below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Specifier</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex-formatted string to print arbitrary binary content returned by the buf (<a href="#functions_buf">buf</a>) function.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Supported escape sequences</p>
</div>
<div class="paragraph">
<p>Colors are supported too, using standard terminal escape sequences:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>print("\033[31mRed\t\033[33mYellow\033[0m\n")</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_probes">Probes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>bpftrace supports various probe types which allow the user to attach BPF programs to different types of events.
Each probe starts with a provider (e.g. <code>kprobe</code>) followed by a colon (<code>:</code>) separated list of options.
The amount of options and their meaning depend on the provider and are detailed below.
The valid values for options can depend on the system or binary being traced, e.g. for uprobes it depends on the binary.
Also see <a href="#_listing_probes">Listing Probes</a></p>
</div>
<div class="paragraph">
<p>It is possible to associate multiple probes with a single action as long as the action is valid for all specified probes.
Multiple probes can be specified as a comma (<code>,</code>) separated list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:tcp_reset,kprobe:tcp_v4_rcv {
  printf("Entered: %s\n", probe);
}</pre>
</div>
</div>
<div class="paragraph">
<p>Wildcards are supported too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:tcp_* {
  printf("Entered: %s\n", probe);
}</pre>
</div>
</div>
<div class="paragraph">
<p>Both can be combined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:tcp_reset,kprobe:*socket* {
  printf("Entered: %s\n", probe);
}</pre>
</div>
</div>
<div class="paragraph">
<p>Most providers also support a short name which can be used instead of the full name, e.g. <code>kprobe:f</code> and <code>k:f</code> are identical.</p>
</div>
<div class="sect2">
<h3 id="probes-begin-end">BEGIN and END</h3>
<div class="paragraph">
<p>These are special built-in events provided by the bpftrace runtime.
<code>BEGIN</code> is triggered before all other probes are attached.
<code>END</code> is triggered after all other probes are detached.</p>
</div>
<div class="paragraph">
<p>Note that specifying an <code>END</code> probe doesn&#8217;t override the printing of 'non-empty' maps at exit.
To prevent the printing all used maps need be cleared, which can be done in the <code>END</code> probe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>END {
    clear(@map1);
    clear(@map2);
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="probes-hardware">hardware</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>hardware:event_name:</code></p>
</li>
<li>
<p><code>hardware:event_name:count</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortname</div>
<ul>
<li>
<p><code>h</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>hardware</code> probe attaches to pre-defined hardware events provided by the kernel.</p>
</div>
<div class="paragraph">
<p>They are implemented using performance monitoring counters (PMCs): hardware resources on the
processor. There are about ten of these, and they are documented in the <code>perf_event_open(2)</code> man page.
The event names are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu-cycles</code> or <code>cycles</code></p>
</li>
<li>
<p><code>instructions</code></p>
</li>
<li>
<p><code>cache-references</code></p>
</li>
<li>
<p><code>cache-misses</code></p>
</li>
<li>
<p><code>branch-instructions</code> or <code>branches</code></p>
</li>
<li>
<p><code>branch-misses</code></p>
</li>
<li>
<p><code>bus-cycles</code></p>
</li>
<li>
<p><code>frontend-stalls</code></p>
</li>
<li>
<p><code>backend-stalls</code></p>
</li>
<li>
<p><code>ref-cycles</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>count</code> option specifies how many events must happen before the probe fires.
If <code>count</code> is left unspecified a default value is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>hardware:cache-misses:1e6 { @[pid] = count(); }</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="probes-interval">interval</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>interval:us:count</code></p>
</li>
<li>
<p><code>interval:ms:count</code></p>
</li>
<li>
<p><code>interval:s:count</code></p>
</li>
<li>
<p><code>interval:hz:rate</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>i</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The interval probe fires at a fixed interval as specified by its time spec.
Interval fire on one CPU at the time, unlike <a href="#profile">[profile]</a> probes.</p>
</div>
</div>
<div class="sect2">
<h3 id="probes-iterator">iterator</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>iter:task</code></p>
</li>
<li>
<p><code>iter:task:pin</code></p>
</li>
<li>
<p><code>iter:task_file</code></p>
</li>
<li>
<p><code>iter:task_file:pin</code></p>
</li>
<li>
<p><code>iter:task_vma</code></p>
</li>
<li>
<p><code>iter:task_vma:pin</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>it</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are eBPF iterator probes, that allow iteration over kernel objects.</p>
</div>
<div class="paragraph">
<p>Iterator probe can&#8217;t be mixed with any other probe, not even other iterator.</p>
</div>
<div class="paragraph">
<p>Each iterator probe provides set of fields that could be accessed with
ctx pointer. User can display set of available fields for iterator via
-lv options as described below.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># bpftrace -e 'iter:task { printf("%s:%d\n", ctx-&gt;task-&gt;comm, ctx-&gt;task-&gt;pid); }'
Attaching 1 probe...
systemd:1
kthreadd:2
rcu_gp:3
rcu_par_gp:4
kworker/0:0H:6
mm_percpu_wq:8
...

# bpftrace -e 'iter:task_file { printf("%s:%d %d:%s\n", ctx-&gt;task-&gt;comm, ctx-&gt;task-&gt;pid, ctx-&gt;fd, path(ctx-&gt;file-&gt;f_path)); }'
Attaching 1 probe...
systemd:1 1:/dev/null
systemd:1 2:/dev/null
systemd:1 3:/dev/kmsg
...
su:1622 1:/dev/pts/1
su:1622 2:/dev/pts/1
su:1622 3:/var/lib/sss/mc/passwd
...
bpftrace:1892 1:pipe:[35124]
bpftrace:1892 2:/dev/pts/1
bpftrace:1892 3:anon_inode:bpf-map
bpftrace:1892 4:anon_inode:bpf-map
bpftrace:1892 5:anon_inode:bpf_link
bpftrace:1892 6:anon_inode:bpf-prog
bpftrace:1892 7:anon_inode:bpf_iter

# bpftrace -e 'iter:task_vma {printf("%s %d %lx-%lx\n", comm, pid, ctx-&gt;vma-&gt;vm_start, ctx-&gt;vma-&gt;vm_end);}'
Attaching 1 probe...
bpftrace 119480 55b92c380000-55b92c386000
bpftrace 119480 55b92c386000-55b92c391000
bpftrace 119480 55b92c391000-55b92c397000
bpftrace 119480 55b92c398000-55b92c399000
bpftrace 119480 55b92c399000-55b92c39a000
bpftrace 119480 55b92cce3000-55b92d010000
...
bpftrace 119480 7ffd55dde000-7ffd55de2000
bpftrace 119480 7ffd55de2000-7ffd55de4000</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s possible to pin iterator with specifying optional probe ':pin' part, that defines the pin file.
It can be specified as absolute path or relative to /sys/fs/bpf.</p>
</div>
<div class="listingblock">
<div class="title">relative pin</div>
<div class="content">
<pre># bpftrace -e 'iter:task:list { printf("%s:%d\n", ctx-&gt;task-&gt;comm, ctx-&gt;task-&gt;pid); }'
Program pinned to /sys/fs/bpf/list</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># cat /sys/fs/bpf/list
systemd:1
kthreadd:2
rcu_gp:3
rcu_par_gp:4
kworker/0:0H:6
mm_percpu_wq:8
rcu_tasks_kthre:9
...</pre>
</div>
</div>
<div class="paragraph">
<p>Examples with absolute pin file:</p>
</div>
<div class="listingblock">
<div class="title">absolute pin</div>
<div class="content">
<pre># bpftrace -e '
iter:task_file:/sys/fs/bpf/files {
  printf("%s:%d %s\n", ctx-&gt;task-&gt;comm, ctx-&gt;task-&gt;pid, path(ctx-&gt;file-&gt;f_path));
}'

Program pinned to /sys/fs/bpf/files</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre># cat /sys/fs/bpf/files
systemd:1 anon_inode:inotify
systemd:1 anon_inode:[timerfd]
...
systemd-journal:849 /dev/kmsg
systemd-journal:849 anon_inode:[eventpoll]
...
sssd:1146 /var/log/sssd/sssd.log
sssd:1146 anon_inode:[eventpoll]
...
NetworkManager:1155 anon_inode:[eventfd]
NetworkManager:1155 /var/lib/sss/mc/passwd (deleted)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="probes-kfunc">kfunc and kretfunc</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>kfunc[:mod]:fn</code></p>
</li>
<li>
<p><code>kretfunc[:mod]:fn</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>f</code> (<code>kfunc</code>)</p>
</li>
<li>
<p><code>fr</code> (<code>kretfunc</code>)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">requires (<code>--info</code>)</div>
<ul>
<li>
<p>Kernel features:BTF</p>
</li>
<li>
<p>Probe types:kfunc</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>kfunc</code>s attach to kernel function similar to <a href="#probes-kprobe">kprobe and kretprobe</a>.
They make use of eBPF trampolines which allows kernel code to call into BPF programs with near zero overhead.</p>
</div>
<div class="paragraph">
<p><code>kfunc</code> s make use of BTF type information to derive the type of function arguments at compile time.
This removes the need for manual type casting and makes the code more resilient against small signature changes in the kernel.
The function arguments are available in the <code>args</code> struct which can be inspected by doing verbose listing (see <a href="#_listing_probes">Listing Probes</a>).
These arguments are also available in the return probe (<code>kretfunc</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre># bpftrace -lv 'kfunc:tcp_reset'
kfunc:tcp_reset
    struct sock * sk
    struct sk_buff * skb</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>kfunc:x86_pmu_stop {
  printf("pmu %s stop\n", str(args.event-&gt;pmu-&gt;name));
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>kretfunc:fget {
  printf("fd %d name %s\n", args.fd, str(retval-&gt;f_path.dentry-&gt;d_name.name));
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>fd 3 name ld.so.cache
fd 3 name libselinux.so.1
fd 3 name libselinux.so.1
...</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>kfunc:kvm:x86_emulate_insn { @ = count(); }</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>@ = 347603</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="probes-kprobe">kprobe and kretprobe</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>kprobe:fn</code></p>
</li>
<li>
<p><code>kprobe:fn+offset</code></p>
</li>
<li>
<p><code>kretprobe:fn</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>k</code></p>
</li>
<li>
<p><code>kr</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>kprobe</code> s allow for dynamic instrumentation of kernel functions.
Each time the specified kernel function is executed the attached BPF programs are ran.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:tcp_reset {
  @tcp_resets = count()
}</pre>
</div>
</div>
<div class="paragraph">
<p>Function arguments are available through the <code>argX</code> and <code>sargX</code> builtins, for register args and stack args respectively.
Whether arguments passed on stack or in a register depends on the architecture and the number or arguments in used, e.g. on x86_64 the first non-floating point 6 arguments are passed in registers, all following arguments are passed on the stack.
Note that floating point arguments are typically passed in special registers which don&#8217;t count as <code>argX</code> arguments which can cause confusion.
Consider a function with the following signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>void func(int a, double d, int x)</pre>
</div>
</div>
<div class="paragraph">
<p>Due to <code>d</code> being a floating point <code>x</code> is accessed through <code>arg1</code> where one might expect <code>arg2</code>.</p>
</div>
<div class="paragraph">
<p>bpftrace does not detect the function signature so it is not aware of the argument count or their type.
It is up to the user to perform <a href="#language_type_conversion">Type conversion</a> when needed, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:tcp_connect
{
  $sk = ((struct sock *) arg0);
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p><code>kprobe</code> s are not limited to function entry, they can be attached to any instruction in a function by specifying an offset from the start of the function.</p>
</div>
<div class="paragraph">
<p><code>kretprobe</code> s trigger on the return from a kernel function.
Return probes do not have access to the function (input) arguments, only to the return value (through <code>retval</code>).
A common pattern to work around this is by storing the arguments in a map on function entry and retrieving in the return probe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kprobe:d_lookup
{
	$name = (struct qstr *)arg1;
	@fname[tid] = $name-&gt;name;
}

kretprobe:d_lookup
/@fname[tid]/
{
	printf("%-8d %-6d %-16s M %s\n", elapsed / 1e6, pid, comm,
	    str(@fname[tid]));
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="probes-profile">profile</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>profile:us:count</code></p>
</li>
<li>
<p><code>profile:ms:count</code></p>
</li>
<li>
<p><code>profile:s:count</code></p>
</li>
<li>
<p><code>profile:hz:rate</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>p</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Profile probes fire on each CPU on the specified interval.</p>
</div>
</div>
<div class="sect2">
<h3 id="probes-software">software</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>software:event:</code></p>
</li>
<li>
<p><code>software:event:count</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>s</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>software</code> probe attaches to pre-defined software events provided by the kernel.
Event details can be found in the <code>perf_event_open(2)</code> man page.</p>
</div>
<div class="paragraph">
<p>The event names are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu-clock</code> or <code>cpu</code></p>
</li>
<li>
<p><code>task-clock</code></p>
</li>
<li>
<p><code>page-faults</code> or <code>faults</code></p>
</li>
<li>
<p><code>context-switches</code> or <code>cs</code></p>
</li>
<li>
<p><code>cpu-migrations</code></p>
</li>
<li>
<p><code>minor-faults</code></p>
</li>
<li>
<p><code>major-faults</code></p>
</li>
<li>
<p><code>alignment-faults</code></p>
</li>
<li>
<p><code>emulation-faults</code></p>
</li>
<li>
<p><code>dummy</code></p>
</li>
<li>
<p><code>bpf-output</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="probes-tracepoint">tracepoint</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>tracepoint:subsys:event</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>t</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tracepoints are hooks into events in the kernel.
Tracepoints are defined in the kernel source and compiled into the kernel binary which makes them a form of static tracing.
Which means that unlike <code>kprobe</code> s new tracepoints cannot be added without modifying the kernel.</p>
</div>
<div class="paragraph">
<p>The advantage of tracepoints is that they generally provide a more stable interface than <code>kprobe</code> s do, they do not depend on the existence of a kernel function.</p>
</div>
<div class="paragraph">
<p>Tracepoint arguments are available in the <code>args</code> struct which can be inspected with verbose listing, see the <a href="#_listing_probes">Listing Probes</a> section for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>tracepoint:syscalls:sys_enter_openat {
  printf("%s %s\n", comm, str(args.filename));
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>irqbalance /proc/interrupts
irqbalance /proc/stat
snmpd /proc/diskstats
snmpd /proc/stat
snmpd /proc/vmstat
snmpd /proc/net/dev
[...]</pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional information</div>
<ul>
<li>
<p><a href="https://www.kernel.org/doc/html/latest/trace/tracepoints.html" class="bare">https://www.kernel.org/doc/html/latest/trace/tracepoints.html</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="probes-rawtracepoint">rawtracepoint</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>rawtracepoint:event</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>rt</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The hook point triggered by <code>tracepoint</code> and <code>rawtracepoint</code> is the same.
<code>tracepoint</code> and <code>rawtracepoint</code> are nearly identical in terms of functionality. The only difference is in the program context. <code>rawtracepoint</code> offers raw arguments to the tracepoint while <code>tracepoint</code> applies further processing to the raw arguments. The additional processing is defined inside the kernel.</p>
</div>
<div class="paragraph">
<p>Tracepoint arguments are available via the <code>argN</code> builtins. The available arguments can be found in the relative path of the kernel source code <code>include/trace/events/</code>.
Each arg is a 64-bit integer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>rawtracepoint:block_rq_insert {
  printf("%llx %llx\n", arg0, arg1);
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>ffff88810977d6f8 ffff8881097e8e80
[...]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="probes-uprobe">uprobe, uretprobe</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>uprobe:binary:func</code></p>
</li>
<li>
<p><code>uprobe:binary:func+offset</code></p>
</li>
<li>
<p><code>uprobe:binary:offset</code></p>
</li>
<li>
<p><code>uretprobe:binary:func</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>u</code></p>
</li>
<li>
<p><code>ur</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>uprobe</code> s or user-space probes are the user-space equivalent of <code>kprobe</code> s.
The same limitations that apply <a href="#probes-kprobe">kprobe and kretprobe</a> also apply to <code>uprobe</code> s and <code>uretprobe</code> s.</p>
</div>
<div class="paragraph">
<p>When tracing libraries, it is sufficient to specify the library name instead of
a full path. The path will be then automatically resolved using <code>/etc/ld.so.cache</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># bpftrace -e 'uprobe:libc:malloc { printf("Allocated %d bytes\n", arg0); }'
Allocated 4 bytes
...</pre>
</div>
</div>
<div class="paragraph">
<p>If the traced binary has DWARF included, function arguments are available in the <code>args</code> struct which can be inspected with verbose listing, see the <a href="#_listing_probes">Listing Probes</a> section for more details.</p>
</div>
<div class="paragraph">
<p>When tracing C&#43;&#43; programs, it is possible to turn on automatic symbol demangling
by using the <code>:cpp</code> prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># bpftrace -e 'u:src/bpftrace:cpp:"bpftrace::BPFtrace::add_probe" { print("adding probe\n"); }'
Attaching 1 probe...
adding probe</pre>
</div>
</div>
<div class="paragraph">
<p>It is important to note that for <code>uretprobe</code> s to work the kernel runs a special helper on user-space function entry which overrides the return address on the stack.
This can cause issues with languages that have their own runtime like Golang:</p>
</div>
<div class="listingblock">
<div class="title">example.go</div>
<div class="content">
<pre>func myprint(s string) {
  fmt.Printf("Input: %s\n", s)
}

func main() {
  ss := []string{"a", "b", "c"}
  for _, s := range ss {
    go myprint(s)
  }
  time.Sleep(1*time.Second)
}</pre>
</div>
</div>
<div class="listingblock">
<div class="title">bpftrace</div>
<div class="content">
<pre># bpftrace -e 'uretprobe:./test:main.myprint { @=count(); }' -c ./test
runtime: unexpected return pc for main.myprint called from 0x7fffffffe000
stack: frame={sp:0xc00008cf60, fp:0xc00008cfd0} stack=[0xc00008c000,0xc00008d000)
fatal error: unknown caller pc</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="probes-usdt">usdt</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>usdt:binary:name</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>U</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="probes-watchpoint">watchpoint and asyncwatchpoint</h3>
<div class="ulist">
<div class="title">variants</div>
<ul>
<li>
<p><code>watchpoint:absolute_address:length:mode</code></p>
</li>
<li>
<p><code>watchpoint:function+argN:length:mode</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">shortnames</div>
<ul>
<li>
<p><code>w</code></p>
</li>
<li>
<p><code>aw</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are memory watchpoints provided by the kernel. Whenever a memory address is written to (<code>w</code>), read
from (<code>r</code>), or executed (<code>x</code>), the kernel can generate an event.</p>
</div>
<div class="paragraph">
<p>In the first form, an absolute address is monitored. If a pid (<code>-p</code>) or a command (<code>-c</code>) is provided,
bpftrace takes the address as a userspace address and monitors the appropriate process. If not,
bpftrace takes the address as a kernel space address.</p>
</div>
<div class="paragraph">
<p>In the second form, the address present in <code>argN</code> when <code>function</code> is entered is
monitored. A pid or command must be provided for this form. If synchronous (<code>watchpoint</code>), a
<code>SIGSTOP</code> is sent to the tracee upon function entry. The tracee will be <code>SIGCONT</code>ed after the
watchpoint is attached. This is to ensure events are not missed. If you want to avoid the
<code>SIGSTOP</code> + <code>SIGCONT</code> use <code>asyncwatchpoint</code>.</p>
</div>
<div class="paragraph">
<p>Note that on most architectures you may not monitor for execution while monitoring read or write.</p>
</div>
<div class="paragraph">
<p>Examples</p>
</div>
<div class="paragraph">
<p>Print <code>hit</code> when a read from or write to <code>0x10000000</code> happens:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># bpftrace -e 'watchpoint:0x10000000:8:rw { printf("hit!\n"); exit(); }' -c ./testprogs/watchpoint</code></pre>
</div>
</div>
<div class="paragraph">
<p>Print the call stack every time the <code>jiffies</code> variable is updated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># bpftrace -e "watchpoint:0x$(awk '$3 == "jiffies" {print $1}' /proc/kallsyms):8:w {
  @[kstack] = count();
}

i:s:1 { exit(); }"
......
@[
    do_timer+12
    tick_do_update_jiffies64.part.22+89
    tick_sched_do_timer+103
    tick_sched_timer+39
    __hrtimer_run_queues+256
    hrtimer_interrupt+256
    smp_apic_timer_interrupt+106
    apic_timer_interrupt+15
    cpuidle_enter_state+188
    cpuidle_enter+41
    do_idle+536
    cpu_startup_entry+25
    start_secondary+355
    secondary_startup_64+164
]: 319</code></pre>
</div>
</div>
<div class="paragraph">
<p>"hit" and exit when the memory pointed to by <code>arg1</code> of <code>increment</code> is written to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code># cat wpfunc.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

__attribute__((noinline))
void increment(__attribute__((unused)) int _, int *i)
{
  (*i)++;
}

int main()
{
  int *i = malloc(sizeof(int));
  while (1)
  {
    increment(0, i);
    (*i)++;
    usleep(1000);
  }
}

# bpftrace -e 'watchpoint:increment+arg1:4:w { printf("hit!\n"); exit() }' -c ./wpfunc</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_listing_probes">Listing Probes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Probe listing is the method to discover which probes are supported by the current system.
Listing supports the same syntax as normal attachment does:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># bpftrace -l 'kprobe:*'
# bpftrace -l 't:syscalls:*openat*
# bpftrace -l 'kprobe:tcp*,trace
# bpftrace -l 'k:*socket*,tracepoint:syscalls:*tcp*'</pre>
</div>
</div>
<div class="paragraph">
<p>The verbose flag (<code>-v</code>) can be specified to inspect arguments (<code>args</code>) for providers that support it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># bpftrace -l 'fr:tcp_reset,t:syscalls:sys_enter_openat' -v
kretfunc:tcp_reset
    struct sock * sk
    struct sk_buff * skb
tracepoint:syscalls:sys_enter_openat
    int __syscall_nr
    int dfd
    const char * filename
    int flags
    umode_t mode
# bpftrace -l 'uprobe:/bin/bash:rl_set_prompt' -v    # works only if /bin/bash has DWARF
uprobe:/bin/bash:rl_set_prompt
    const char *prompt</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-08-24 10:43:52 +0800
</div>
</div>
</body>
</html>